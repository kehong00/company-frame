<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="/layui/css/layui.css">
    <link rel="stylesheet" href="/css/custom.form.css">
</head>
<body>
<div class="menu-table">
    <table class="layui-table" id="menuTable" lay-filter="menuTablel">

    </table>
</div>
<div id="menuTree">

</div>
</body>
<script src="/layui/layui.js"></script>
<script src="/js/core.util.js"></script>
<script>
    layui.config({
        base: '/'
    }).extend({
        treetable: 'treetable-lay/treetable'
    }).use(['treetable', 'table', 'tree', 'jquery', 'form'], function () {
        var layer = layui.layer;
        var $ = layui.jquery;
        var form = layui.form;
        var treetable = layui.treetable;
        var table = layui.table;

        var selectNode = true;

        /*获取所有的菜单权限数据*/
        CoreUtil.sendAjax("/api/permissions", null, function (res) {
            // console.log(res.data);
            // renderTable(res.data);
            testTable(res.data);
            renderTable(res.data);
        }, "GET", true, null, false);

        var renderTable = function (data){
            treetable.render({
                data: data,
                treeColIndex: 1,
                treeSpid: 0,
                treeIdName: 'id',
                treePidName: 'pid',
                treeDefaultClose: false,
                treeLinkage: false,
                elem: '#menuTable',
                page: false,
                cols: [
                    [
                        {type: 'numbers'},
                        {field: 'name',title: '菜单名称'},
                        {filed: 'url',title: 'url'},
                        {filed: 'method',title: '请求方式'},
                        {
                            field: 'type',title: '类型',templet: function(item){
                                if(item.type === 1){
                                    return `<a class="layui-btn layui-btn-xs">目录</a>`;
                                }else if(item.type === 2){
                                    return `<a class="layui-btn layui-btn-xs layui-btn-normal">菜单</a>`;
                                }else if(item.type ===3){
                                    return `<a class="layui-btn layui-btn-xs layui-btn-warm">按钮</a>`;
                                }
                            }
                        },
                        {field: 'pidName', title: '父级名称'},
                        {field: 'orderNum', title: '排序'},
                        {field: 'perms', title: '资源标识'},
                        {field: 'code', title: '前后端分离按钮控制标识'},
                        {
                            field: 'createTime', title: '创建时间', minWidth: 120, templet: function(item){
                                return CoreUtil.formattime(item.createTime);
                            }
                        },
                        {
                            field: 'status', title: '状态', templet: function(item){
                                if (item.status === 1){
                                    return `<input type="checkbox" lay-skin="switch" lay-text="启用|禁用" checked disabled>`;
                                }else if(item.status === 0){
                                    return `<input type="checkbox" lay-skin="switch" lay-text="启用|禁用" disabled>`;
                                }
                            }
                        },
                        {title: '操作', width: 180}
                    ]
                ]
            });
        };

        var testTable = function (data){
            alert('test');
            // console.log(data);
            var menuTable = $('#menuTable');
            menuTable.append('<tbody>');
            $.each(data,function (index,item) {
                // menuTable.append("<tr>");
                console.log(item);
                var type = '<a class="layui-btn layui-btn-xs layui-btn-normal" >菜单 </a>';
                var strings = `<tr><td>${item.name}</td><td>${item.url}</td><td>${item.method}</td><td>${item.type}</td><td>${item.pidName}</td>
                               <td>${item.orderNum}</td><td>${item.method}</td><td>${item.method}</td><td>${item.method}</td><td>${item.method}</td>
                               <td><input type="checkbox" lay-skin="switch" lay-text="启用|禁用" checked disabled></td></tr>
                              `;
                menuTable.append(strings);
                // menuTable.append("</tr>");

            });
            menuTable.append('</tbody>');
        }


    })
    /*初始化菜单权限列表数据*/
</script>
</html>